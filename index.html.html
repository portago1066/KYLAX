<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KY Girls Lacrosse ‚Äî Ask Anything</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,600;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --blue: #003f8a;
    --gold: #c8982a;
    --cream: #f5f0e8;
    --dark: #0d1117;
    --mid: #1c2535;
    --light-blue: #4a8fd4;
    --text: #e8e4dc;
    --muted: #7a8699;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--dark);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Field lines background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      repeating-linear-gradient(0deg, transparent, transparent 79px, rgba(0,63,138,0.12) 79px, rgba(0,63,138,0.12) 80px),
      repeating-linear-gradient(90deg, transparent, transparent 79px, rgba(0,63,138,0.08) 79px, rgba(0,63,138,0.08) 80px);
    pointer-events: none;
    z-index: 0;
  }

  .page {
    position: relative;
    z-index: 1;
    max-width: 860px;
    margin: 0 auto;
    padding: 48px 24px 80px;
  }

  /* Header */
  header {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin-bottom: 48px;
    animation: fadeUp 0.6s ease both;
  }

  .eyebrow {
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    font-size: 11px;
    letter-spacing: 0.22em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 6px;
  }

  h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(52px, 10vw, 96px);
    line-height: 0.92;
    letter-spacing: 0.01em;
    color: var(--cream);
  }

  h1 span {
    color: var(--gold);
    display: block;
  }

  .subtitle {
    margin-top: 14px;
    font-size: 15px;
    font-weight: 300;
    color: var(--muted);
    max-width: 420px;
    line-height: 1.6;
  }

  /* API Key section */
  .api-section {
    background: rgba(28, 37, 53, 0.8);
    border: 1px solid rgba(200,152,42,0.2);
    border-radius: 12px;
    padding: 20px 24px;
    margin-bottom: 32px;
    animation: fadeUp 0.6s 0.1s ease both;
  }

  .api-section label {
    display: block;
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 8px;
    font-weight: 600;
  }

  .api-row {
    display: flex;
    gap: 10px;
  }

  .api-input {
    flex: 1;
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    padding: 10px 14px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .api-input:focus { border-color: var(--gold); }

  .btn-save {
    background: var(--gold);
    color: var(--dark);
    border: none;
    border-radius: 8px;
    padding: 10px 18px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    transition: opacity 0.2s;
    white-space: nowrap;
  }
  .btn-save:hover { opacity: 0.85; }

  .api-hint {
    margin-top: 8px;
    font-size: 12px;
    color: var(--muted);
  }
  .api-hint a { color: var(--light-blue); }

  /* Quick buttons */
  .quick-label {
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 12px;
    font-weight: 600;
    animation: fadeUp 0.6s 0.2s ease both;
  }

  .quick-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 32px;
    animation: fadeUp 0.6s 0.25s ease both;
  }

  .quick-btn {
    background: rgba(28,37,53,0.9);
    border: 1px solid rgba(74,143,212,0.25);
    border-radius: 20px;
    padding: 7px 16px;
    color: var(--light-blue);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 400;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .quick-btn:hover {
    background: rgba(74,143,212,0.15);
    border-color: var(--light-blue);
    color: var(--cream);
  }

  /* Chat area */
  .chat-box {
    min-height: 300px;
    margin-bottom: 24px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    animation: fadeUp 0.6s 0.3s ease both;
  }

  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 0;
    color: var(--muted);
    text-align: center;
    gap: 12px;
  }

  .empty-state .lacrosse-icon {
    font-size: 48px;
    opacity: 0.4;
  }

  .empty-state p {
    font-size: 15px;
    font-style: italic;
    font-weight: 300;
    max-width: 300px;
    line-height: 1.5;
  }

  .message {
    display: flex;
    flex-direction: column;
    gap: 4px;
    animation: fadeUp 0.4s ease both;
  }

  .message.user { align-items: flex-end; }
  .message.assistant { align-items: flex-start; }

  .msg-label {
    font-size: 10px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    font-weight: 600;
  }

  .message.user .msg-label { color: var(--gold); }
  .message.assistant .msg-label { color: var(--light-blue); }

  .msg-bubble {
    max-width: 88%;
    padding: 14px 18px;
    border-radius: 12px;
    font-size: 15px;
    line-height: 1.65;
    font-weight: 300;
  }

  .message.user .msg-bubble {
    background: rgba(200,152,42,0.15);
    border: 1px solid rgba(200,152,42,0.3);
    border-bottom-right-radius: 4px;
    color: var(--cream);
  }

  .message.assistant .msg-bubble {
    background: rgba(28,37,53,0.9);
    border: 1px solid rgba(74,143,212,0.2);
    border-bottom-left-radius: 4px;
    color: var(--text);
  }

  .msg-bubble p { margin-bottom: 10px; }
  .msg-bubble p:last-child { margin-bottom: 0; }
  .msg-bubble strong { color: var(--gold); font-weight: 600; }
  .msg-bubble ul { padding-left: 18px; margin: 8px 0; }
  .msg-bubble li { margin-bottom: 4px; }

  /* Sources */
  .sources {
    margin-top: 10px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .source-chip {
    font-size: 11px;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 4px;
    padding: 3px 8px;
    color: var(--muted);
    text-decoration: none;
    transition: color 0.2s;
  }
  .source-chip:hover { color: var(--light-blue); }

  /* Loading */
  .loading-bubble {
    background: rgba(28,37,53,0.9);
    border: 1px solid rgba(74,143,212,0.2);
    border-bottom-left-radius: 4px;
    border-radius: 12px;
    padding: 14px 18px;
    display: flex;
    gap: 6px;
    align-items: center;
  }

  .dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--light-blue);
    animation: bounce 1.2s infinite;
  }
  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }

  /* Input area */
  .input-area {
    position: sticky;
    bottom: 24px;
    animation: fadeUp 0.6s 0.35s ease both;
  }

  .input-wrap {
    display: flex;
    gap: 10px;
    background: rgba(28,37,53,0.95);
    border: 1px solid rgba(200,152,42,0.3);
    border-radius: 14px;
    padding: 10px 10px 10px 18px;
    backdrop-filter: blur(12px);
    box-shadow: 0 8px 40px rgba(0,0,0,0.5);
  }

  .input-wrap:focus-within {
    border-color: var(--gold);
  }

  textarea {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    font-weight: 300;
    resize: none;
    line-height: 1.5;
    max-height: 140px;
    min-height: 24px;
    padding-top: 2px;
  }

  textarea::placeholder { color: var(--muted); }

  .btn-ask {
    background: var(--blue);
    border: 1px solid rgba(74,143,212,0.3);
    border-radius: 10px;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    flex-shrink: 0;
    align-self: flex-end;
  }

  .btn-ask:hover { background: var(--light-blue); }
  .btn-ask:disabled { opacity: 0.4; cursor: default; }

  .btn-ask svg { width: 18px; height: 18px; fill: white; }

  /* Error */
  .error-msg {
    background: rgba(200,50,50,0.15);
    border: 1px solid rgba(200,50,50,0.3);
    border-radius: 10px;
    padding: 12px 16px;
    font-size: 14px;
    color: #f08080;
    margin-bottom: 16px;
  }

  /* Animations */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes bounce {
    0%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-8px); }
  }

  /* Divider line */
  .divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(200,152,42,0.3), transparent);
    margin: 36px 0 28px;
  }

  /* Status badge */
  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--muted);
    margin-top: 8px;
  }

  .status-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: #4caf50;
  }

  .status-badge.no-key .status-dot { background: #888; }
</style>
</head>
<body>
<div class="page">

  <header>
    <div class="eyebrow">Kentucky High School Athletics</div>
    <h1>Girls<span>Lacrosse</span></h1>
    <p class="subtitle">Ask about KHSAA rules, recent scores, standings, player eligibility, and anything Kentucky HS girls lacrosse.</p>
  </header>

  <!-- API Key -->
  <div class="api-section">
    <label for="apiKey">Perplexity API Key</label>
    <div class="api-row">
      <input type="password" class="api-input" id="apiKey" placeholder="pplx-xxxxxxxxxxxxxxxx" autocomplete="off">
      <button class="btn-save" onclick="saveKey()">Save Key</button>
    </div>
    <p class="api-hint">Get a free key at <a href="https://www.perplexity.ai/settings/api" target="_blank">perplexity.ai/settings/api</a> ‚Äî your key is stored only in your browser's localStorage.</p>
    <div class="status-badge no-key" id="statusBadge">
      <span class="status-dot"></span>
      <span id="statusText">No API key saved</span>
    </div>
  </div>

  <div class="divider"></div>

  <!-- Quick questions -->
  <p class="quick-label">Quick questions</p>
  <div class="quick-grid">
    <button class="quick-btn" onclick="quickAsk('What are the current KHSAA rules for girls lacrosse?')">KHSAA Rules</button>
    <button class="quick-btn" onclick="quickAsk('What are the latest Kentucky high school girls lacrosse scores this week?')">Latest Scores</button>
    <button class="quick-btn" onclick="quickAsk('What are the KHSAA girls lacrosse playoff standings and rankings this season?')">Standings & Rankings</button>
    <button class="quick-btn" onclick="quickAsk('What are the player eligibility rules for KHSAA girls lacrosse?')">Eligibility Rules</button>
    <button class="quick-btn" onclick="quickAsk('How long are quarters and what are the overtime rules in KHSAA girls lacrosse?')">Game Format</button>
    <button class="quick-btn" onclick="quickAsk('What equipment is required for KHSAA girls lacrosse players?')">Equipment Rules</button>
    <button class="quick-btn" onclick="quickAsk('Which Kentucky high school girls lacrosse teams are ranked highest this season?')">Top Teams</button>
    <button class="quick-btn" onclick="quickAsk('What are the penalty and foul rules in KHSAA girls lacrosse?')">Penalties & Fouls</button>
  </div>

  <!-- Chat -->
  <div class="chat-box" id="chatBox">
    <div class="empty-state" id="emptyState">
      <div class="lacrosse-icon">ü•ç</div>
      <p>Ask anything about Kentucky high school girls lacrosse ‚Äî rules, scores, teams, and more.</p>
    </div>
  </div>

  <div id="errorContainer"></div>

  <!-- Input -->
  <div class="input-area">
    <div class="input-wrap">
      <textarea id="questionInput" placeholder="Ask about rules, scores, teams..." rows="1"
        onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
      <button class="btn-ask" id="askBtn" onclick="askQuestion()" title="Ask">
        <svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
      </button>
    </div>
  </div>

</div>

<script>
  const SYSTEM_PROMPT = `You are an expert on Kentucky high school girls lacrosse. You have deep knowledge of:
- KHSAA (Kentucky High School Athletic Association) rules and regulations for girls lacrosse
- Current season scores, standings, and game results
- Team rankings and playoff information
- Player eligibility rules
- Equipment requirements
- Game format, timing, and overtime rules
- Penalty and foul rules specific to KHSAA

Always search for the most current information. When discussing scores or standings, note the date of the information. Be specific and helpful. Format responses clearly with headers when appropriate.`;

  let apiKey = localStorage.getItem('pplx_api_key') || '';
  let isLoading = false;
  const history = [];

  // Init
  if (apiKey) {
    document.getElementById('apiKey').value = apiKey;
    setStatus(true);
  }

  function saveKey() {
    const val = document.getElementById('apiKey').value.trim();
    if (!val) return;
    apiKey = val;
    localStorage.setItem('pplx_api_key', val);
    setStatus(true);
  }

  function setStatus(hasKey) {
    const badge = document.getElementById('statusBadge');
    const text = document.getElementById('statusText');
    if (hasKey) {
      badge.classList.remove('no-key');
      badge.querySelector('.status-dot').style.background = '#4caf50';
      text.textContent = 'API key saved';
    } else {
      badge.classList.add('no-key');
      badge.querySelector('.status-dot').style.background = '#888';
      text.textContent = 'No API key saved';
    }
  }

  function autoResize(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 140) + 'px';
  }

  function handleKey(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      askQuestion();
    }
  }

  function quickAsk(q) {
    document.getElementById('questionInput').value = q;
    askQuestion();
  }

  function showError(msg) {
    const c = document.getElementById('errorContainer');
    c.innerHTML = `<div class="error-msg">${msg}</div>`;
    setTimeout(() => c.innerHTML = '', 6000);
  }

  function addMessage(role, content, sources) {
    const empty = document.getElementById('emptyState');
    if (empty) empty.remove();

    const box = document.getElementById('chatBox');
    const div = document.createElement('div');
    div.className = `message ${role}`;

    const label = document.createElement('div');
    label.className = 'msg-label';
    label.textContent = role === 'user' ? 'You' : 'KY Lacrosse AI';

    const bubble = document.createElement('div');
    bubble.className = 'msg-bubble';
    bubble.innerHTML = formatContent(content);

    div.appendChild(label);
    div.appendChild(bubble);

    if (sources && sources.length) {
      const srcDiv = document.createElement('div');
      srcDiv.className = 'sources';
      sources.slice(0, 5).forEach((s, i) => {
        const a = document.createElement('a');
        a.className = 'source-chip';
        a.href = s.url || '#';
        a.target = '_blank';
        a.textContent = s.name || `Source ${i+1}`;
        srcDiv.appendChild(a);
      });
      div.appendChild(srcDiv);
    }

    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
    return div;
  }

  function formatContent(text) {
    return text
      .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
      .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.+?)\*/g, '<em>$1</em>')
      .replace(/^### (.+)$/gm, '<strong>$1</strong>')
      .replace(/^## (.+)$/gm, '<strong>$1</strong>')
      .replace(/^# (.+)$/gm, '<strong>$1</strong>')
      .replace(/^\- (.+)$/gm, '<li>$1</li>')
      .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>')
      .replace(/\n\n/g, '</p><p>')
      .replace(/^(.+)$(?!\<\/p\>)/gm, (m) => m.startsWith('<') ? m : m)
      .replace(/\n/g, '<br>')
      .replace(/^(?!<)(.+)/gm, (m) => `<p>${m}</p>`)
      .replace(/<p><\/p>/g, '');
  }

  function addLoading() {
    const box = document.getElementById('chatBox');
    const div = document.createElement('div');
    div.className = 'message assistant';
    div.id = 'loadingMsg';

    const label = document.createElement('div');
    label.className = 'msg-label';
    label.textContent = 'KY Lacrosse AI';

    const bubble = document.createElement('div');
    bubble.className = 'loading-bubble';
    bubble.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';

    div.appendChild(label);
    div.appendChild(bubble);
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
  }

  function removeLoading() {
    const el = document.getElementById('loadingMsg');
    if (el) el.remove();
  }

  async function askQuestion() {
    if (isLoading) return;
    if (!apiKey) {
      showError('Please enter and save your Perplexity API key first.');
      document.getElementById('apiKey').focus();
      return;
    }

    const input = document.getElementById('questionInput');
    const question = input.value.trim();
    if (!question) return;

    input.value = '';
    input.style.height = 'auto';
    isLoading = true;
    document.getElementById('askBtn').disabled = true;

    addMessage('user', question);
    history.push({ role: 'user', content: question });
    addLoading();

    try {
      const messages = [
        { role: 'system', content: SYSTEM_PROMPT },
        ...history
      ];

      const res = await fetch('https://api.perplexity.ai/chat/completions', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${apiKey}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          model: 'sonar-pro',
          messages,
          max_tokens: 1024,
          search_domain_filter: [],
          return_citations: true,
          search_recency_filter: 'month'
        })
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err.error?.message || `API error ${res.status}`);
      }

      const data = await res.json();
      const reply = data.choices?.[0]?.message?.content || 'No response received.';
      const sources = data.citations || [];

      history.push({ role: 'assistant', content: reply });

      removeLoading();
      addMessage('assistant', reply, sources.map((url, i) => {
        try { return { url, name: new URL(url).hostname.replace('www.','') }; }
        catch { return { url, name: `Source ${i+1}` }; }
      }));

    } catch (err) {
      removeLoading();
      showError(`Error: ${err.message}`);
    } finally {
      isLoading = false;
      document.getElementById('askBtn').disabled = false;
    }
  }
</script>
</body>
</html>
